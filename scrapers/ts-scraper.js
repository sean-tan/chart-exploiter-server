const fetch = require('node-fetch');
const cheerio = require('cheerio');

const endPoints = {
    top100 : 'https://www.traxsource.com/top/tracks',
    house : 'https://www.traxsource.com/genre/4/house/top',
    deepHouse : 'https://www.traxsource.com/genre/13/deep-house/top',
    nuDiscoIndieDance: 'https://www.traxsource.com/genre/17/nu-disco-indie-dance/top',
    jackingHouse: 'https://www.traxsource.com/genre/15/jackin-house/top',
    techHouse: 'https://www.traxsource.com/genre/18/tech-house/top',
    electronic: 'https://www.traxsource.com/genre/5/electronica/top'
};

function getListData(req) {
    let genre = req.params.genre;
    return fetch(`${endPoints[genre]}`)
        .then(response => response.text())
        .then(body => {
            let songs = [];
            const $ = cheerio.load(body);
            $('.trk-row').each(function(i, element){
                const el = $(element);
                const num = el.find('.tnum-pos').text().trim();
                const title = el.find('.title').text().trim();
                const artists = el.find('.artists').text().trim();
                const labels = el.find('.label').text().trim();
                const genre = el.find('.genre').text().trim();
                const released = el.find('.r-date').text().trim();

                const song = {
                    num,
                    artists,
                    title,
                    labels,
                    genre,
                    released,
                };
                songs.push(song);
            });
            return songs;
        }).catch(error => {
            console.log(error.message)
        });
}
module.exports = { getListData };
