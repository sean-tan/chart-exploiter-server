const fetch = require('node-fetch');
const cheerio = require('cheerio');

const endPoints = {
    top100 : 'https://www.beatport.com/top-100',
    house : 'https://www.beatport.com/genre/house/5/top-100',
    deephouse : 'https://www.beatport.com/genre/deep-house/12/top-100',
    funksoul: 'https://www.beatport.com/genre/funk-soul-disco/40/top-100',
    funkygroovejackinghouse: 'https://www.beatport.com/genre/funky-groove-jackin-house/81/top-100',
    futurehouse: 'https://www.beatport.com/genre/future-house/65/top-100',
    indedancenudisco: 'https://www.beatport.com/genre/indie-dance-nu-disco/37/top-100',
    techhouse: 'https://www.beatport.com/genre/tech-house/11/top-100'
};

function getListData(req) {
    let genre = req.params.genre;
    return fetch(`${endPoints[genre]}`)
            .then(response => response.text())
            .then(body => {
                let songs = [];
                const $ = cheerio.load(body);
                $('.bucket-item').each(function(i, element){
                    const el = $(element);
                    const num = el.find('.buk-track-num').text().trim();
                    const artists = el.find('.buk-track-artists').text().trim();
                    const title = el.find('.buk-track-title').text().trim();
                    const labels = el.find('.buk-track-labels').text().trim();
                    const genre = el.find('.buk-track-genre').text().trim();
                    const released = el.find('.buk-track-released').text().trim();

                    const song = {
                        num,
                        artists,
                        title,
                        labels,
                        genre,
                        released,
                    };
                    songs.push(song);
                });
                return songs;
            }).catch(error => {
                console.log(error.message)
            });
}
module.exports = { getListData };
