const fetch = require("node-fetch");
const cheerio = require("cheerio");

const endPoints = {
  top100: "https://www.beatport.com/top-100",
  afrohouse: "https://www.beatport.com/genre/afro-house/89/top-100",
  basshouse: "https://www.beatport.com/genre/bass-house/91/top-100",
  deephouse: "https://www.beatport.com/genre/deep-house/12/top-100",
  funksoul: "https://www.beatport.com/genre/funk-soul-disco/40/top-100",
  funkygroovejackinghouse:
    "https://www.beatport.com/genre/funky-groove-jackin-house/81/top-100",
  futurehouse: "https://www.beatport.com/genre/future-house/65/top-100",
  house: "https://www.beatport.com/genre/house/5/top-100",
  indiedance: "https://www.beatport.com/genre/indie-dance/37/top-100",
  nudisco: "https://www.beatport.com/genre/nu-disco-disco/50/top-100",
  melodichousetechno:
    "https://www.beatport.com/genre/melodic-house-and-techno/90/top-100",
  techhouse: "https://www.beatport.com/genre/tech-house/11/top-100",
  techno: "https://www.beatport.com/genre/techno/6/top-100"
};

function getListData(req) {
  let genre = req.params.genre;
  return fetch(`${endPoints[genre]}`)
    .then((response) => response.text())
    .then((body) => {
      let songs = [];
      const $ = cheerio.load(body);
      $(".bucket-item").each(function(i, element) {
        const el = $(element);
        const num = el
          .find(".buk-track-num")
          .text()
          .trim();
        const artists = el
          .find(".buk-track-artists")
          .text()
          .trim();
        const title = el
          .find(".buk-track-title")
          .text()
          .trim();
        const labels = el
          .find(".buk-track-labels")
          .text()
          .trim();
        const genre = el
          .find(".buk-track-genre")
          .text()
          .trim();
        const released = el
          .find(".buk-track-released")
          .text()
          .trim();
        const artwork = el
          .find(".buk-track-artwork-parent img")
          .attr('src')
          .trim();

        const song = {
          num,
          artists,
          title,
          labels,
          genre,
          released, 
          artwork
        };
        songs.push(song);
      });
      return songs;
    })
    .catch((error) => {
      console.log(error.message);
    });
}
module.exports = { getListData };
